name: Generate Model Card

on:
  workflow_dispatch:
    inputs:
      repository:
        description: 'Docker Hub repository name in aistaging namespace (e.g., "qwen3")'
        required: true
        type: string
      reference_urls:
        description: 'Comma-separated reference URLs (HuggingFace pages, blog posts, papers, etc.)'
        required: true
        type: string

permissions:
  contents: write
  pull-requests: write

jobs:
  generate:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd

      - name: Generate model card
        uses: docker/cagent-action@bd5439a1cabc3c448abf7a0d29b6f9a0d5fd4ec7
        with:
          agent: .github/agents/model-card-generator.yaml
          anthropic-api-key: ${{ secrets.ANTHROPIC_API_KEY }}
          prompt: |
            **Repository:** aistaging/${{ inputs.repository }}
            **Model name:** ${{ inputs.repository }}
            **Reference URLs to research:**
            ${{ inputs.reference_urls }}

      - name: Verify model card was generated
        run: |
          if [ ! -f "model-cards/${{ inputs.repository }}.md" ]; then
            echo "::error::Model card file was not generated at model-cards/${{ inputs.repository }}.md"
            exit 1
          fi
          echo "âœ… Model card generated successfully:"
          head -20 "model-cards/${{ inputs.repository }}.md"

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@22a9089034f40e5a961c8808d113e2c98fb63676
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: "Add model card for aistaging/${{ inputs.repository }}"
          title: "Add model card for aistaging/${{ inputs.repository }}"
          body: |
            ## ðŸ¤– Auto-generated Model Card

            This PR adds a model card for **aistaging/${{ inputs.repository }}**.

            ### Reference URLs used
            ${{ inputs.reference_urls }}

            ### Generated by
            This model card was automatically generated using [cagent-action](https://github.com/docker/cagent-action) with the [Docker Model Runner's model-card-generator](https://github.com/docker/model-runner).

            ---
            Please review the generated content for accuracy before merging.
          branch: model-card/${{ inputs.repository }}
          base: main
          labels: model-card,automated
          delete-branch: true
